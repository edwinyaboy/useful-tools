<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Leak Checker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
  :root {
    --primary: #4caf50;
    --primary-hover: #32cd32;
    --card-bg: rgba(30, 30, 30, 0.95);
    --text-color: #f0f0f0;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #000;
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 40px 20px;
  }

  .container {
    background: var(--card-bg);
    backdrop-filter: blur(8px);
    padding: 25px;
    border-radius: 16px;
    max-width: 650px;
    width: 100%;
    box-shadow: 0 10px 30px rgba(0, 255, 0, 0.1);
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: relative;
  }

  h1 { text-align: center; font-size: 24px; }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .input-group label {
    font-size: 0.9rem;
    font-weight: 500;
  }

  input, button {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: #2a2a2a;
    color: var(--text-color);
    font-size: 1rem;
  }

  input[type="password"] { -webkit-text-security: disc; }

  button {
    background: linear-gradient(90deg, var(--primary), var(--primary-hover));
    color: #fff;
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s;
    font-weight: bold;
  }

  button:hover {
    background: linear-gradient(90deg, var(--primary-hover), var(--primary));
    box-shadow: 0 0 10px var(--primary-hover);
  }

  .result { font-size: 1rem; margin-top: 12px; word-break: break-word; }
  .safe { color: #0f0; }
  .pwned { color: #f44336; }
  .error-text { color: #f44336; font-size: 0.85rem; margin-top: 4px; display: none; }

  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: #000;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10;
  }
  .toast.show { opacity: 1; }
</style>
</head>
<body>
<div class="container">
  <h1>Password Leak Checker</h1>

  <div class="input-group">
    <label for="passwordInput">Enter Password</label>
    <input type="password" id="passwordInput" placeholder="Password" aria-label="Enter password">
    <small class="error-text" id="passwordError">Invalid password</small>
  </div>

  <button id="checkBtn">Check Password</button>

  <div class="result" id="result"></div>
</div>

<div id="toast" class="toast"></div>

<script>
// Show toast messages
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Sanitize text
function sanitizeText(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// SHA1 hashing using Web Crypto
async function sha1(str) {
  const buffer = new TextEncoder().encode(str);
  const hashBuffer = await crypto.subtle.digest('SHA-1', buffer);
  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2,'0')).join('').toUpperCase();
}

// Sanitize & validate password
function validatePassword(pw) {
  if (!pw) return { valid: false, msg: 'Password cannot be empty.' };
  const trimmed = pw.trim();
  if (trimmed.length < 6) return { valid: false, msg: 'Password must be at least 6 characters.' };
  if (trimmed.length > 128) return { valid: false, msg: 'Password is too long.' };
  return { valid: true, pw: trimmed };
}

// Check password against HIBP
async function checkPassword() {
  const inputEl = document.getElementById('passwordInput');
  const resultEl = document.getElementById('result');
  const errorEl = document.getElementById('passwordError');

  const { valid, pw, msg } = validatePassword(inputEl.value);
  if (!valid) {
    errorEl.textContent = sanitizeText(msg);
    errorEl.style.display = 'block';
    resultEl.textContent = '';
    return;
  }
  errorEl.style.display = 'none';
  resultEl.textContent = 'Checking...';

  try {
    const hash = await sha1(pw);
    const prefix = hash.slice(0,5);
    const suffix = hash.slice(5);

    const response = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
    const text = await response.text();
    const lines = text.split('\n');

    let found = 0;
    for (let line of lines) {
      const [hashSuffix, count] = line.split(':');
      if (hashSuffix.trim() === suffix) {
        found = parseInt(count);
        break;
      }
    }

    if (found > 0) {
      resultEl.innerHTML = `⚠️ This password has been seen <span class="pwned">${found.toLocaleString()}</span> times in breaches. Consider changing it.`;
    } else {
      resultEl.innerHTML = `✅ This password was <span class="safe">not found</span> in known breaches.`;
    }

  } catch (err) {
    console.error(err);
    resultEl.innerHTML = `<span class="error-text">Error checking password. Try again.</span>`;
    showToast('Failed to check password. Ensure you are online.');
  }
}

// Event listeners
document.getElementById('checkBtn').addEventListener('click', checkPassword);
document.getElementById('passwordInput').addEventListener('keypress', e => {
  if (e.key === 'Enter') checkPassword();
});
</script>
</body>
</html>
