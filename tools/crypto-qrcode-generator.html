<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Wallet QR Code Generator</title>
  <style>
    :root {
      --primary: #4caf50;
      --primary-hover: #32cd32;
      --card-bg: rgba(30, 30, 30, 0.95);
      --text-color: #f0f0f0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #000;
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
    }

    .container {
      background: var(--card-bg);
      backdrop-filter: blur(8px);
      padding: 25px;
      border-radius: 16px;
      max-width: 650px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 255, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative;
    }

    h1 {
      text-align: center;
      margin: 0 0 10px 0;
      font-size: 24px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-group label {
      font-size: 0.9rem;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #2a2a2a;
      color: var(--text-color);
      font-size: 1rem;
    }

    input[type="color"] {
      width: 60px;
      height: 40px;
      padding: 4px;
      cursor: pointer;
      border-radius: 8px;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    .flex-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
    }

    button {
      padding: 12px;
      background: linear-gradient(90deg, var(--primary), var(--primary-hover));
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s, box-shadow 0.3s;
      font-weight: bold;
    }

    button:hover {
      background: linear-gradient(90deg, var(--primary-hover), var(--primary));
      box-shadow: 0 0 10px var(--primary-hover);
    }

    button:focus {
      outline: 2px solid #fff;
      outline-offset: 2px;
    }

    .btn-outline-primary {
      background: none;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline-primary:hover {
      background: linear-gradient(90deg, var(--primary), var(--primary-hover));
      color: var(--text-color);
      box-shadow: 0 0 10px var(--primary-hover);
    }

    #qrcode {
      display: flex;
      justify-content: center;
      margin-top: 16px;
    }

    #qrcode canvas {
      border-radius: 12px;
      border: 8px solid #fff;
      box-shadow: 0 0 12px rgba(50, 205, 50, 0.6);
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: #000;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
    }

    .toast.show {
      opacity: 1;
    }

    .error-text {
      color: #f44336;
      font-size: 0.85rem;
      margin-top: 4px;
      display: none;
    }

    .generated-msg {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: var(--primary);
      color: #000;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 10;
    }

    @media (max-width: 500px) {
      .container {
        padding: 16px;
      }

      h1 {
        font-size: 20px;
      }

      .flex-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Crypto Wallet QR Code Generator</h1>

    <div class="input-group">
      <label for="cryptoSelect">Cryptocurrency</label>
      <select id="cryptoSelect" aria-label="Select cryptocurrency">
        <option value="bitcoin">₿ Bitcoin (BTC)</option>
        <option value="ethereum">Ξ Ethereum (ETH)</option>
        <option value="solana">S Solana (SOL)</option>
        <option value="xrp">₿ XRP (Ripple)</option>
        <option value="cardano">₳ Cardano (ADA)</option>
        <option value="dogecoin">Ð Dogecoin (DOGE)</option>
        <option value="tron">TRX TRON (TRX)</option>
        <option value="litecoin">Ł Litecoin (LTC)</option>
        <option value="dash">D Dash (DASH)</option>
        <option value="bitcoincash">₿ Bitcoin Cash (BCH)</option>
      </select>
    </div>

    <div class="input-group">
      <label for="address">Wallet Address</label>
      <input type="text" id="address" list="addressHistory" placeholder="Enter wallet address" required aria-label="Enter wallet address">
      <datalist id="addressHistory"></datalist>
      <small class="error-text">Enter a valid wallet address</small>
    </div>

    <div class="input-group">
      <label for="amount">Amount (optional)</label>
      <input type="number" id="amount" placeholder="Enter amount" step="0.00000001" min="0" aria-label="Enter amount (optional)">
      <small class="error-text">Enter a valid amount (positive number)</small>
    </div>

    <div class="flex-row">
      <div class="input-group">
        <label for="fgColor">Foreground Color</label>
        <input type="color" id="fgColor" class="color-input" value="#000000" aria-label="Select QR code foreground color">
      </div>
      <div class="input-group">
        <label for="bgColor">Background Color</label>
        <input type="color" id="bgColor" class="color-input" value="#ffffff" aria-label="Select QR code background color">
      </div>
    </div>

    <div class="flex-row">
      <div class="input-group">
        <label for="size">QR Code Size</label>
        <select id="size" aria-label="Select QR code size">
          <option value="150">150x150</option>
          <option value="200" selected>200x200</option>
          <option value="250">250x250</option>
          <option value="300">300x300</option>
        </select>
      </div>
    </div>

    <div class="flex-row">
      <button id="generate" aria-label="Generate QR Code">Generate QR Code</button>
      <button id="copy" aria-label="Copy QR Code">Copy</button>
      <button id="downloadPng" aria-label="Download QR Code as PNG">Download PNG</button>
      <button id="downloadSvg" class="btn-outline-primary" aria-label="Download QR Code as SVG">Download SVG</button>
    </div>

    <div id="qrcode"></div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script>
    let qrcode = null;

    const elements = {
      generate: document.getElementById('generate'),
      copy: document.getElementById('copy'),
      downloadPng: document.getElementById('downloadPng'),
      downloadSvg: document.getElementById('downloadSvg'),
      cryptoSelect: document.getElementById('cryptoSelect'),
      address: document.getElementById('address'),
      amount: document.getElementById('amount'),
      fgColor: document.getElementById('fgColor'),
      bgColor: document.getElementById('bgColor'),
      size: document.getElementById('size'),
      qrcode: document.getElementById('qrcode'),
      toast: document.getElementById('toast'),
      addressHistory: document.getElementById('addressHistory')
    };

    let cryptoHistory = JSON.parse(localStorage.getItem('cryptoHistory')) || {
      bitcoin: [], ethereum: [], solana: [], xrp: [], cardano: [],
      dogecoin: [], tron: [], litecoin: [], dash: [], bitcoincash: []
    };

    function saveHistory() {
      localStorage.setItem('cryptoHistory', JSON.stringify(cryptoHistory));
    }

    function loadHistory(cryptoType) {
      elements.addressHistory.innerHTML = '';
      cryptoHistory[cryptoType].forEach(addr => {
        const option = document.createElement('option');
        option.value = addr;
        elements.addressHistory.appendChild(option);
      });
    }

    function addToHistory(cryptoType, address) {
      if (!cryptoHistory[cryptoType].includes(address)) {
        cryptoHistory[cryptoType].unshift(address);
        if (cryptoHistory[cryptoType].length > 10) {
          cryptoHistory[cryptoType].pop();
        }
        saveHistory();
        loadHistory(cryptoType);
      }
    }

    function showToast(message) {
      elements.toast.textContent = message;
      elements.toast.classList.add('show');
      setTimeout(() => elements.toast.classList.remove('show'), 3000);
    }

    function isValidAddress(address, cryptoType) {
      const patterns = {
        bitcoin: /^(1|3|bc1)[a-zA-Z0-9]{25,44}$/,
        ethereum: /^0x[a-fA-F0-9]{40}$/,
        solana: /^[1-9A-HJ-NP-Za-km-z]{32,44}$/,
        xrp: /^r[0-9a-zA-Z]{24,34}$/,
        cardano: /^[A-Q][0-9a-zA-HJ-NP-Z]{103}$/,
        dogecoin: /^D[5-9A-HJ-NP-U][1-9A-HJ-NP-Za-km-z]{25,34}$/,
        tron: /^T[A-Za-z0-9]{33}$/,
        litecoin: /^(L|M)[a-zA-Z0-9]{26,44}$/,
        dash: /^X[a-zA-Z0-9]{33,44}$/,
        bitcoincash: /^(q|p)[a-z0-9]{41,42}$|^bitcoincash:[qp][a-z0-9]{41,42}$/
      };
      return patterns[cryptoType]?.test(address) || false;
    }

    function getBrightness(hex) {
      const rgb = parseInt(hex.slice(1), 16);
      const r = (rgb >> 16) & 255;
      const g = (rgb >> 8) & 255;
      const b = rgb & 255;
      return (r * 299 + g * 587 + b * 114) / 1000;
    }

    function checkContrast(fg, bg) {
      const fgBrightness = getBrightness(fg);
      const bgBrightness = getBrightness(bg);
      return Math.abs(fgBrightness - bgBrightness) >= 125;
    }

    function formatQRData() {
      const cryptoType = elements.cryptoSelect.value;
      const address = elements.address.value.trim();
      const amount = elements.amount.value.trim();

      if (!address) {
        elements.address.nextElementSibling.style.display = 'block';
        showToast('Wallet address is required');
        return null;
      }

      if (!isValidAddress(address, cryptoType)) {
        elements.address.nextElementSibling.style.display = 'block';
        showToast('Enter a valid wallet address for the selected cryptocurrency');
        return null;
      } else {
        elements.address.nextElementSibling.style.display = 'none';
      }

      if (amount && (isNaN(amount) || amount < 0)) {
        elements.amount.nextElementSibling.style.display = 'block';
        showToast('Enter a valid amount (positive number)');
        return null;
      } else {
        elements.amount.nextElementSibling.style.display = 'none';
      }

      return `${cryptoType}:${address}${amount ? `?amount=${amount}` : ''}`;
    }

    async function generateQR() {
      const { fgColor, bgColor, size, qrcode: container } = elements;
      const sizeValue = parseInt(size.value);

      if (!/^#[0-9A-F]{6}$/i.test(fgColor.value) || !/^#[0-9A-F]{6}$/i.test(bgColor.value)) {
        showToast('Invalid color selected');
        return;
      }

      if (!checkContrast(fgColor.value, bgColor.value)) {
        showToast('Increase contrast between foreground and background colors');
        return;
      }

      if (isNaN(sizeValue) || sizeValue < 100 || sizeValue > 500) {
        showToast('Invalid size selected');
        return;
      }

      const text = formatQRData();
      if (!text) return;

      container.innerHTML = '';
      elements.generate.disabled = true;
      elements.generate.textContent = 'Generating...';

      try {
        qrcode = new QRCode(container, {
          text: text,
          width: sizeValue,
          height: sizeValue,
          colorDark: fgColor.value,
          colorLight: bgColor.value,
          correctLevel: QRCode.CorrectLevel.H
        });

        const canvas = await new Promise((resolve, reject) => {
          const checkCanvas = () => {
            const cv = container.querySelector('canvas');
            if (cv) resolve(cv);
            else setTimeout(checkCanvas, 50);
          };
          checkCanvas();
          setTimeout(() => reject(new Error('Canvas not found after timeout')), 2000);
        });

        const msg = document.createElement('div');
        msg.className = 'generated-msg';
        msg.textContent = 'Generated!';
        document.body.appendChild(msg);
        setTimeout(() => msg.remove(), 1000);

        const cryptoType = elements.cryptoSelect.value;
        const address = elements.address.value.trim();
        addToHistory(cryptoType, address);
      } catch (error) {
        showToast(error.message || 'Error generating QR Code');
      } finally {
        elements.generate.disabled = false;
        elements.generate.textContent = 'Generate QR Code';
      }
    }

    async function copyQR() {
      const canvas = elements.qrcode.querySelector('canvas');
      if (!canvas) {
        showToast('Generate QR code first');
        return;
      }

      if (!navigator.clipboard || !window.ClipboardItem) {
        showToast('Clipboard API not supported in this browser');
        return;
      }

      try {
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        if (!blob) throw new Error('Failed to create blob');
        await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
        const msg = document.createElement('div');
        msg.className = 'generated-msg';
        msg.textContent = 'Copied!';
        document.body.appendChild(msg);
        setTimeout(() => msg.remove(), 1000);
      } catch (error) {
        showToast('Failed to copy QR Code: ' + error.message);
      }
    }

    function downloadQR(format = 'png') {
      const canvas = elements.qrcode.querySelector('canvas');
      if (!canvas) {
        showToast('Generate QR code first');
        return;
      }

      try {
        const link = document.createElement('a');
        if (format === 'svg') {
          const svg = generateSvg();
          const blob = new Blob([svg], { type: 'image/svg+xml' });
          link.href = URL.createObjectURL(blob);
          link.download = 'qrcode.svg';
        } else {
          link.href = canvas.toDataURL('image/png');
          link.download = 'qrcode.png';
        }
        link.click();
        showToast(`QR Code download started (${format.toUpperCase()})`);
      } catch (error) {
        showToast('Failed to download QR Code: ' + error.message);
      }
    }

    function generateSvg() {
      const size = parseInt(elements.size.value);
      const fgColor = elements.fgColor.value;
      const bgColor = elements.bgColor.value;
      const text = formatQRData();
      if (!text) return '';

      const qr = new QRCode({
        text: text,
        width: size,
        height: size,
        colorDark: fgColor,
        colorLight: bgColor,
        correctLevel: QRCode.CorrectLevel.H
      });

      return qr._oDrawing._el.outerHTML;
    }

    loadHistory(elements.cryptoSelect.value);

    elements.cryptoSelect.addEventListener('change', () => {
      elements.address.value = '';
      loadHistory(elements.cryptoSelect.value);
    });

    elements.generate.addEventListener('click', generateQR);
    elements.copy.addEventListener('click', copyQR);
    elements.downloadPng.addEventListener('click', () => downloadQR('png'));
    elements.downloadSvg.addEventListener('click', () => downloadQR('svg'));
    elements.address.addEventListener('keypress', e => {
      if (e.key === 'Enter') generateQR();
    });
  </script>
</body>
</html>
